<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>Bingxin WebTrace</title>
    <link rel="stylesheet" href="https://unpkg.com/office-ui-fabric-core@11.1.0/dist/css/fabric.min.css">
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@fluentui/react@8/dist/fluentui-react.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3f2f1;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            min-width: 400px;
            max-width: 1200px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .form-group {
            min-width: 200px;
            margin-bottom: 15px;
            width: 100%;
        }
        .spinner {
            display: none;
            margin: 20px auto;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #0078d4;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .footer {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const { useState, useEffect } = React;
        const { PrimaryButton, Dropdown, TextField, Spinner, SpinnerSize, initializeIcons, Stack, Text, CommandBar } = FluentUIReact;

        initializeIcons();

        const commandOptions = [
            { key: 'traceroute', text: 'Traceroute' },
            { key: 'ping', text: 'Ping' },
            { key: 'mtr', text: 'MTR' }
        ];

        const navItems = [
            {
                key: 'home',
                text: 'Home',
                iconProps: { iconName: 'Home' },
                href: '#'
            },
            {
                key: 'about',
                text: 'About',
                iconProps: { iconName: 'Info' },
                href: '#'
            }
        ];

        function App() {
            const [command, setCommand] = useState('traceroute');
            const [target, setTarget] = useState('');
            const [output, setOutput] = useState('');
            const [loading, setLoading] = useState(false);
            const [currentTime, setCurrentTime] = useState(new Date().toLocaleTimeString());
            const [quote, setQuote] = useState('');

            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date().toLocaleTimeString());
                }, 1000);

                fetch('https://v1.hitokoto.cn')
                    .then(response => response.json())
                    .then(data => setQuote(data.hitokoto));

                return () => clearInterval(timer);
            }, []);

            const executeCommand = () => {
                setLoading(true);
                setOutput('');
                fetch('http://localhost:5000/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ command, target })
                })
                .then(response => response.json())
                .then(data => {
                    setOutput(data.result);
                    setLoading(false);
                })
                .catch(error => {
                    setOutput('执行命令时出错：' + error);
                    setLoading(false);
                });
            };

            return (
                React.createElement('div', { className: 'container' },
                    React.createElement(CommandBar, { items: navItems }),
                    React.createElement('h1', { className: 'ms-fontSize-32 ms-fontWeight-semibold' }, 'Bingxin WebTrace'),
                    React.createElement(Stack, { tokens: { childrenGap: 15 }, horizontalAlign: 'center' },
                        React.createElement('div', { className: 'form-group' },
                            React.createElement(Text, { variant: 'large' }, '选择命令'),
                            React.createElement(Dropdown, {
                                placeholder: '选择命令',
                                options: commandOptions,
                                selectedKey: command,
                                onChange: (e, option) => setCommand(option.key),
                                styles: { dropdown: { width: '100%' } }
                            })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement(Text, { variant: 'large' }, '目标地址（IPv4/IPv6）'),
                            React.createElement(TextField, {
                                placeholder: '例如：10.50.0.41 或 fddd:5050::1:41',
                                value: target,
                                onChange: (e, newValue) => setTarget(newValue),
                                styles: { fieldGroup: { width: '100%' } }
                            })
                        ),
                        React.createElement(PrimaryButton, { text: '执行', onClick: executeCommand }),
                        React.createElement(Text, { variant: 'small', styles: { root: { marginTop: 10 } } }, '请耐心等待3-60秒钟'),
                        loading && React.createElement(Spinner, { size: SpinnerSize.large }),
                        React.createElement('pre', null, output),
                        React.createElement('div', { className: 'footer' },
                            React.createElement(Text, { variant: 'medium' }, quote)
                        )
                    )
                )
            );
        }

        ReactDOM.render(React.createElement(App), document.getElementById('app'));
    </script>
</body>
</html>
